import { useState } from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { CheckCircle2, Sparkles, Shield } from \"lucide-react\";\nimport type { ParsedResumeData } from \"@/pages/ResumeBuilder\";\nimport ResumePreview from \"@/components/resume-builder/ResumePreview\";\n\ninterface TemplateSelectionProps {\n  parsedData: ParsedResumeData;\n  onTemplateSelected: (templateId: string) => void;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  description: string;\n  preview: string;\n  atsOptimized: boolean;\n  recommended?: boolean;\n  recommendedReason?: string;\n  features: string[];\n  previewComponent: JSX.Element;\n}\n\n// Sample data for template previews\nconst sampleResumeData: ParsedResumeData = {\n  fullName: \"John Doe\",\n  email: \"john.doe@example.com\",\n  phone: \"(123) 456-7890\",\n  location: \"San Francisco, CA\",\n  linkedin: \"linkedin.com/in/johndoe\",\n  summary:\n    \"Highly motivated and results-oriented software engineer with 5+ years of experience in developing and deploying scalable web applications.\",\n  experience: [\n    {\n      title: \"Software Engineer\",\n      company: \"Tech Solutions Inc.\",\n      location: \"San Francisco, CA\",\n      startDate: \"Jan 2022\",\n      endDate: \"Present\",\n      description: [\n        \"Developed and maintained full-stack web applications using React, Node.js, and PostgreSQL.\",\n        \"Led a team of 3 engineers in the successful launch of a new product feature, increasing user engagement by 20%.\",\n        \"Implemented CI/CD pipelines, reducing deployment time by 50%.\",\n      ],\n    },\n    {\n      title: \"Junior Developer\",\n      company: \"Innovate Corp.\",\n      location: \"Seattle, WA\",\n      startDate: \"Jun 2020\",\n      endDate: \"Dec 2021\",\n      description: [\n        \"Contributed to the development of a mobile application using React Native.\",\n        \"Assisted in bug fixing and performance optimization.\",\n      ],\n    },\n  ],\n  education: [\n    {\n      degree: \"Master of Science in Computer Science\",\n      institution: \"University of California, Berkeley\",\n      location: \"Berkeley, CA\",\n      graduationDate: \"May 2022\",\n      gpa: \"3.9\",\n    },\n    {\n      degree: \"Bachelor of Science in Software Engineering\",\n      institution: \"University of Washington\",\n      location: \"Seattle, WA\",\n      graduationDate: \"May 2020\",\n      gpa: \"3.8\",\n    },\n  ],\n  skills: [\n    \"JavaScript\",\n    \"TypeScript\",\n    \"React\",\n    \"Node.js\",\n    \"PostgreSQL\",\n    \"AWS\",\n    \"Docker\",\n    \"Git\",\n    \"Agile Methodologies\",\n  ],\n  projects: [],\n  certifications: [],\n};\n\nconst templates: Template[] = [\n  {\n    id: \"modern-minimal\",\n    name: \"Modern Minimal\",\n    description: \"Clean, single-column layout perfect for tech professionals\",\n    preview: \"A simple, elegant design with clear section headers\",\n    atsOptimized: true,\n    recommended: true,\n    recommendedReason: \"Recommended for AI/ML professionals - emphasizes technical skills and projects\",\n    features: [\n      \"Single-column layout\",\n      \"Standard fonts (Arial, Calibri)\",\n      \"Clear section headers\",\n      \"No images or graphics\",\n      \"Excellent ATS compatibility\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"default-template\" />\n      </div>\n    ),\n  },\n  {\n    id: \"professional-classic\",\n    name: \"Professional Classic\",\n    description: \"Traditional format trusted by Fortune 500 companies\",\n    preview: \"A timeless design with traditional formatting\",\n    atsOptimized: true,\n    recommended: true,\n    recommendedReason: \"Improved layout for showcasing extensive experience\",\n    features: [\n      \"Traditional structure\",\n      \"Experience-focused\",\n      \"High readability\",\n      \"No tables or columns\",\n      \"Proven ATS success rate\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"professional-classic\" />\n      </div>\n    ),\n  },\n  {\n    id: \"technical-focused\",\n    name: \"Technical Focused\",\n    description: \"Optimized for engineering and technical roles\",\n    preview: \"Technical layout emphasizing skills and projects\",\n    atsOptimized: true,\n    recommended: true,\n    recommendedReason: \"Enhanced for technical project showcase\",\n    features: [\n      \"Skills section prominence\",\n      \"Project-focused layout\",\n      \"Technical certifications highlight\",\n      \"Clean bullet points\",\n      \"ATS-friendly formatting\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"technical-focused\" />\n      </div>\n    ),\n  },\n  {\n    id: \"executive-summary\",\n    name: \"Executive Summary\",\n    description: \"Leadership-focused template for senior positions\",\n    preview: \"Professional layout for executive-level resumes\",\n    atsOptimized: true,\n    features: [\n      \"Executive summary section\",\n      \"Achievement-focused\",\n      \"Leadership emphasis\",\n      \"Clean structure\",\n      \"ATS compliant\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"executive-summary\" />\n      </div>\n    ),\n  },\n  {\n    id: \"academic-research\",\n    name: \"Academic & Research\",\n    description: \"Designed for academic and research positions\",\n    preview: \"Academic-focused layout with publications section\",\n    atsOptimized: true,\n    features: [\n      \"Publications section\",\n      \"Research highlights\",\n      \"Academic credentials focus\",\n      \"Simple formatting\",\n      \"ATS compatible\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"academic-research\" />\n      </div>\n    ),\n  },\n  {\n    id: \"creative-professional\",\n    name: \"Creative Professional\",\n    description: \"Balanced design for creative roles\",\n    preview: \"Professional yet creative layout\",\n    atsOptimized: true,\n    features: [\n      \"Portfolio integration\",\n      \"Project showcase\",\n      \"Skills visualization\",\n      \"ATS-safe design\",\n      \"Professional appearance\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"creative-professional\" />\n      </div>\n    ),\n  },\n  {\n    id: \"skill-focused\",\n    name: \"Skill-Focused\",\n    description: \"Highlights your skills prominently for technical roles and career changers.\",\n    preview: \"A template that emphasizes your core competencies and technical abilities.\",\n    atsOptimized: true,\n    features: [\n      \"Prominent skills section\",\n      \"Grouped skills for readability\",\n      \"Strong for technical or specialized roles\",\n      \"ATS-friendly skill parsing\",\n      \"Clear and concise layout\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"skill-focused\" />\n      </div>\n    ),\n  },\n  {\n    id: \"achievement-driven\",\n    name: \"Achievement-Driven\",\    description: \"Focuses on measurable accomplishments and impact in previous roles.\",\n    preview: \"A results-oriented template designed to showcase your impact.\",\n    atsOptimized: true,\n    features: [\n      \"Quantifiable achievements emphasized\",\n      \"Impact-focused bullet points\",\n      \"Strong for senior roles and promotions\",\n      \"ATS-compatible action verbs\",\n      \"Professional and direct\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"achievement-driven\" />\n      </div>\n    ),\n  },\n  {\n    id: \"chronological\",\n    name: \"Chronological\",\n    description: \"Standard reverse-chronological format, ideal for consistent career paths.\",\n    preview: \"A traditional template showcasing career progression.\",\n    atsOptimized: true,\n    features: [\n      \"Traditional and widely accepted\",\n      \"Clear career progression\",\n      \"Easy for recruiters to follow\",\n      \"Excellent ATS compatibility\",\n      \"Simple and professional\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"chronological\" />\n      </div>\n    ),\n  },\n  {\n    id: \"simple-modern\",\n    name: \"Simple Modern\",\n    description: \"A clean and straightforward design with a contemporary feel.\",\n    preview: \"A minimalist template with a modern aesthetic.\",\n    atsOptimized: true,\n    features: [\n      \"Minimalist design\",\n      \"Modern font choices\",\n      \"High readability\",\n      \"Focus on content clarity\",\n      \"ATS-friendly\",\n    ],\n    previewComponent: (\n      <div className=\"scale-[0.5] origin-top-left w-[200%] h-[200%] p-4\">\n        <ResumePreview resumeData={sampleResumeData} templateId=\"simple-modern\" />\n      </div>\n    ),\n  },\n];\n\nconst TemplateSelection = ({ parsedData, onTemplateSelected }: TemplateSelectionProps) => {\n  const [selectedTemplate, setSelectedTemplate] = useState<string>(\"\");\n\n  const recommendedTemplates = templates.filter((t) => t.recommended);\n  const allTemplates = templates;\n\n  const handleTemplateSelect = (templateId: string) => {\n    setSelectedTemplate(templateId);\n  };\n\n  const handleContinue = () => {\n    if (selectedTemplate) {\n      onTemplateSelected(selectedTemplate);\n    }\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      <div className=\"text-center mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Choose Your Template</h1>\n        <p className=\"text-muted-foreground\">\n          Select from AI-recommended templates or browse our ATS-optimized gallery\n        </p>\n      </div>\n\n      <Tabs defaultValue=\"recommended\" className=\"w-full\">\n        <TabsList className=\"grid w-full max-w-md mx-auto grid-cols-2 mb-8\">\n          <TabsTrigger value=\"recommended\" className=\"gap-2\">\n            <Sparkles className=\"h-4 w-4\" />\n            AI Recommended\n          </TabsTrigger>\n          <TabsTrigger value=\"gallery\" className=\"gap-2\">\n            <Shield className=\"h-4 w-4\" />\n            ATS Gallery\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"recommended\" className=\"space-y-6\">\n          <Card className=\"p-6 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 border-blue-200 dark:border-blue-900\">\n            <div className=\"flex items-start gap-4\">\n              <Sparkles className=\"h-6 w-6 text-blue-600 mt-1\" />\n              <div>\n                <h3 className=\"font-semibold text-lg mb-2\">AI-Powered Recommendations</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Based on your profile, we\'ve selected templates that will best showcase your experience\n                  {parsedData.fullName && ` as ${parsedData.fullName}`}. These templates are optimized for\n                  applicant tracking systems and designed to increase your interview chances.\n                </p>\n              </div>\n            </div>\n          </Card>\n\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {recommendedTemplates.map((template) => (\n              <Card\n                key={template.id}\n                className={`p-6 cursor-pointer transition-all hover:shadow-lg ${\n                  selectedTemplate === template.id\n                    ? \"ring-2 ring-primary shadow-lg\"\n                    : \"hover:border-primary/50\"\n                }`}\n                onClick={() => handleTemplateSelect(template.id)}\n              >\n                <div className=\"flex items-start justify-between mb-4\">\n                  <Badge\n                    variant=\"secondary\"\n                    className=\"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-100\"\n                  >\n                    <Sparkles className=\"h-3 w-3 mr-1\" />\n                    Recommended\n                  </Badge>\n                  {selectedTemplate === template.id && (\n                    <CheckCircle2 className=\"h-5 w-5 text-primary\" />\n                  )}\n                </div>\n\n                <div className=\"aspect-[8.5/11] bg-muted rounded mb-4 flex items-center justify-center overflow-hidden\">\n                  {template.previewComponent}\n                </div>\n\n                <h3 className=\"font-semibold text-lg mb-2\">{template.name}</h3>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  {template.description}\n                </p>\n\n                {template.recommendedReason && (\n                  <div className=\"bg-blue-50 dark:bg-blue-950/20 rounded-lg p-3 mb-3\">\n                    <p className=\"text-xs text-blue-700 dark:text-blue-300\">\n                      <strong>Why recommended:</strong> {template.recommendedReason}\n                    </p>\n                  </div>\n                )}\n\n                <div className=\"space-y-1 mb-4\">\n                  {template.features.slice(0, 3).map((feature, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center gap-2 text-xs text-muted-foreground\"\n                    >\n                      <CheckCircle2 className=\"h-3 w-3 text-green-600\" />\n                      {feature}\n                    </div>\n                  ))}\n                </div>\n\n                <Button\n                  variant={selectedTemplate === template.id ? \"default\" : \"outline\"}\n                  className=\"w-full\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleTemplateSelect(template.id);\n                  }}\n                >\n                  {selectedTemplate === template.id ? \"Selected\" : \"Select Template\"}\n                </Button>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"gallery\" className=\"space-y-6\">\n          <Card className=\"p-6 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-900\">\n            <div className=\"flex items-start gap-4\">\n              <Shield className=\"h-6 w-6 text-green-600 mt-1\" />\n              <div>\n                <h3 className=\"font-semibold text-lg mb-2\">100% ATS-Optimized Templates</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Every template in our gallery is designed to pass Applicant Tracking Systems with the\n                  following guarantees:\n                </p>\n                <ul className=\"space-y-2 text-sm\">\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                    <span>\n                      <strong>No Visual Clutter:</strong> Excludes images, graphs, colors, and tables that\n                      confuse ATS\n                    </span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                    <span>\n                      <strong>Standard Structure:</strong> Single-column layouts with clearly labeled\n                      sections\n                    </span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                    <span>\n                      <strong>High Readability:</strong> Standard fonts with appropriate margins and\n                      whitespace\n                    </span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                    <span>\n                      <strong>Proven Compatibility:</strong> Pre-tested for text selection and system parsing\n                    </span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </Card>\n\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {allTemplates.map((template) => (\n              <Card\n                key={template.id}\n                className={`p-6 cursor-pointer transition-all hover:shadow-lg ${\n                  selectedTemplate === template.id\n                    ? \"ring-2 ring-primary shadow-lg\"\n                    : \"hover:border-primary/50\"\n                }`}\n                onClick={() => handleTemplateSelect(template.id)}\n              >\n                <div className=\"flex items-start justify-between mb-4\">\n                  <Badge\n                    variant=\"secondary\"\n                    className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-100\"\n                  >\n                    <Shield className=\"h-3 w-3 mr-1\" />\n                    ATS Optimized\n                  </Badge>\n                  {selectedTemplate === template.id && (\n                    <CheckCircle2 className=\"h-5 w-5 text-primary\" />\n                  )}\n                </div>\n\n                <div className=\"aspect-[8.5/11] bg-muted rounded mb-4 flex items-center justify-center overflow-hidden\">\n                  {template.previewComponent}\n                </div>\n\n                <h3 className=\"font-semibold text-lg mb-2\">{template.name}</h3>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  {template.description}\n                </p>\n\n                <div className=\"space-y-1 mb-4\">\n                  {template.features.slice(0, 3).map((feature, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center gap-2 text-xs text-muted-foreground\"\n                    >\n                      <CheckCircle2 className=\"h-3 w-3 text-green-600\" />\n                      {feature}\n                    </div>\n                  ))}\n                </div>\n\n                <Button\n                  variant={selectedTemplate === template.id ? \"default\" : \"outline\"}\n                  className=\"w-full\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleTemplateSelect(template.id);\n                  }}\n                >\n                  {selectedTemplate === template.id ? \"Selected\" : \"Select Template\"}\n                </Button>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {selectedTemplate && (\n        <div className=\"fixed bottom-0 left-0 right-0 bg-background border-t p-4 shadow-lg\">\n          <div className=\"container mx-auto flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">\n                {templates.find((t) => t.id === selectedTemplate)?.name} selected\n              </p>\n              <p className=\"text-sm text-muted-foreground\">Ready to customize your resume</p>\n            </div>\n            <Button size=\"lg\" onClick={handleContinue}>\n              Continue to Editor\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default TemplateSelection;\n